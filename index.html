<!DOCTYPE html>
<html>
  <head>
    <title>Gestionnaire de tâches</title>
  </head>
  <body>
    <h1>Gestionnaire de tâches</h1>
    
    <!-- Formulaire pour ajouter une nouvelle tâche -->
    <form>
      <label for="task">Nouvelle tâche :</label>
      <input type="text" id="task" name="task">
      <br>
      <label for="deadline">Date de fin :</label>
      <input type="date" id="deadline" name="deadline">
      <br>
      <button id="ajt" type="button" onclick="addTask()">Ajouter</button>
      <br>      
      <label for="deadline">Nom de la tâche à supprimée :</label>
      <input type="text" id="taskdel" name="taskdel">
      <button id="sup" type="button" onclick="delTask()">Supprimer</button>
    </form>
    
    <!-- Liste des tâches ajoutées -->
    <ul id="taskList"></ul>
    
    <script>
      // Tableau pour stocker les tâches
      let tasks = [];
      
      // Fonction pour ajouter une tâche
      function addTask() {
        let taskInput = document.getElementById("task");
        let deadlineInput = document.getElementById("deadline");
        
        // Vérifier si les champs sont remplis
        if (taskInput.value === "" || deadlineInput.value === "") {
          alert("Veuillez remplir tous les champs.");
          return;
        }
        
        // Ajouter la tâche au tableau
        let task = {
          name: taskInput.value,
          deadline: new Date(deadlineInput.value)
        };
        tasks.push(task);
        //ajoutbdd(task);
        
        // Réinitialiser les champs du formulaire
        taskInput.value = "";
        deadlineInput.value = "";
        
        // Mettre à jour la liste des tâches
        updateTaskList();
      }

      function delTask(){
        let tasknum = document.getElementById("taskdel")
        dTask(tasknum.value);
        return;
      }
      
      function dTask(elem) {
      let taskList = document.getElementById("taskList");
      taskList.innerHTML = "";

      if (elem !== "") {
        for (let i = 0; i < tasks.length; i++) {
          let task = tasks[i];
          if (task.name === elem) {
            tasks.splice(i, 1);
            break; // stop iterating once the task is found and removed
          }
        }
      }
      updateTaskList();
      }
      
      // Fonction pour mettre à jour la liste des tâches
      function updateTaskList() {
        let taskList = document.getElementById("taskList");
        taskList.innerHTML = "";
        
        // Parcourir toutes les tâches et les ajouter à la liste
        for (let i = 0; i < tasks.length; i++) {
          let task = tasks[i];
          let li = document.createElement("li");
          li.innerHTML = task.name + " - Date de fin : " + task.deadline.toLocaleDateString();
          var str = task.deadline.toISOString();
          str.split()
          let timeLeft = document.createElement("span");
          taskList.appendChild(li);
        }
      }
        // Fonction pour mettre à jour le temps restant toutes les secondes
      function updateTimers() {
      // Parcourir toutes les tâches et mettre à jour leur temps restant
      for (let i = 0; i < tasks.length; i++) {
            let task = tasks[i];
            let li = document.getElementById("task" + i);
            let timeLeft = li.querySelector("span");
        }
      }


      function ajoutbdd(task){
            var formData = {
              nom: $(task.name).val(),
              date: $(task.deadline.toLocaleDateString()).val(),
            };

            console.log(formData);

            $.ajax({
              type: "POST",
              url: "ajout.php",
              data: formData,
              dataType: "json",
              encode: true,
            }).done(function (data) {
              console.log(data);
            });

            event.preventDefault();
          };

    </script>
  </body>
</html>
<style>
    body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    }

    h1 {
    text-align: center;
    }

    form {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
    }

    label {
    margin-right: 10px;
    }

    input[type="text"],
    input[type="date"],
    button[type="button"] {
    padding: 5px;
    margin-bottom: 10px;
    border-radius: 5px;
    }

    input[type="text"],
    input[type="date"] {
    width: 200px;
    }

    #ajt {
    background-color: #4CAF50;
    color: white;
    }

    #ajt:hover {
    cursor: pointer;
    background-color: #3e8e41;
    }    
    
    #sup {
    background-color: rgb(153, 43, 16);
    color: white;
    }

    #sup:hover {
    cursor: pointer;
    background-color: rgb(153, 43, 16);
    }

    ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
    }

    li {
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 5px;
    background-color: #f2f2f2;
    text-align: center;
    }
</style>